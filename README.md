Docker-образ Redis базы данных, содержащей [список недействительных российских паспортов с сайта Главного управления по
вопросам миграции МВД России](http://services.fms.gov.ru/info-service.htm?sid=2000).


Описание процесса запуска контейнера
----

При каждом старте контейнера (инициализации), данные о недействительных паспортах загружаются с сайта Главного
управления по вопросам миграции МВД России и сохраняются в Redis.

Время инициализации составляет ~10 минут, но может увеличиваться в зависимости от скорости получения данных с сайта МВД.

Каждые 30 секунд Docker проверяет Health-статус контейнера. Во время инициализации контейнер имеет статус `starting`,
после окончания инициализации контейнер переходит в статус `healthy`.

Если контейнер не успел проинициализироваться в течении 1 часа, он переходит в статус `unhealthy`.


Использование своих настроек Redis
----

Для использования своих настроек Redis, необходимо в контейнер подключить свой файл конфигурации и добавить его
последним аргументом при запуске:

```sh
docker run -v /myredis/conf/redis.conf:/init/custom-redis.conf egorlkn/expired-passports-memdb:latest /init/custom-redis.conf
```


Использование в Kubernetes
----

При использовании образа в Kubernetes, Docker проверка Health-статуса контейнера отключается. Для проверки
работоспособности контейнера необходимо использовать bash скрипты `liveness-check.sh` и `readiness-check.sh` для
соответствующих проб Kubernetes.


Поиск паспорта в базе
----

Поиск паспорта в базе необходимо выполнять по ключу, состоящему из серии и номера паспорта:

```sh
$ redis-cli EXISTS 0303032319
```

Размер базы на 24.08.2019 составляет ~6 ГБ.
